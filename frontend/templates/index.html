<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="SpeedyFlow - JIRA Service Desk Integration Platform">
  <meta name="theme-light" content="ffffff">
  <title>SpeedyFlow - Ticket Management</title>
  
  <!-- ============================================================
       CSS LOADING STRATEGY
       ============================================================
       1. Theme blocker loads first (prevents flash)
       2. app.bundle.css imports all production CSS in order:
          - Foundation (design tokens, variables, layout)
          - Themes (light/dark/transparency)
          - Components (UI elements)
          - Layout (structure)
          - Utilities (interactive features)
          - Fallback (legacy support)
       ============================================================ -->
  
  <!-- THEME BLOCKER: Prevents flash by applying theme BEFORE CSS renders -->
  <script src="/static/js/theme-blocker.js"></script>
  <!-- FlowingContext shim removed (deprecated) -->
  
  <!-- PRIMARY CSS BUNDLE: All production styles orchestrated -->
  <link rel="stylesheet" href="/static/css/app.bundle.css?v={{ timestamp }}">
  
    <!-- The following component CSS files were consolidated into app.bundle.css
      to reduce requests and ensure consistent cascade ordering:
      utils/svg-icons.css,
      components/transition-fields-modal.css,
      components/quick-actions.css,
      components/auto-switch-notification.css,
      components/shadows.css,
      components/purple-accents.css,
      components/sidebar-inline.css,
      user-setup-modal.css,
      flowing-mvp-footer.css
    -->
    <!-- Chart.js for interactive charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Emoji -> SVG runtime replacer (uses SVGIcons.render) -->
    <script src="/static/js/utils/emoji-replacer.js?v={{ timestamp }}"></script>
  
</head>
<body class="theme-dark">
  <!-- Removed debug logs: BODY load console messages were only used during early development. -->
  
  <div class="app-container" role="application" aria-label="SpeedyFlow Ticket Workspace">
    <!-- SIDEBAR (UNIFIED REBUILD) -->
    <!-- SIDEBAR HEADER (Toggle Button) -->
    <aside class="sidebar-header-component" role="banner" aria-label="Sidebar Toggle">
      <button id="sidebarToggleBtn" class="sidebar-toggle-btn" aria-label="Toggle Sidebar">
        <span class="toggle-icon">â˜°</span>
      </button>
    </aside>

    <!-- SIDEBAR ACTION BUTTON (Clone of header style) -->
    <aside class="sidebar-header-component" id="sidebarActionComponent" role="complementary" aria-label="Quick Actions">
      <button id="quickActionBtn" class="sidebar-toggle-btn" aria-label="Quick Action" title="Quick Action">
        <span class="toggle-icon">âš¡</span>
      </button>
    </aside>

    <!-- SIDEBAR CONTENT (Navigation Menu) -->
    <aside class="sidebar-content-component" role="navigation" aria-label="Primary Navigation">
      <div class="sidebar-content">
        <section class="sidebar-section" aria-label="Navigation">
          <span class="sidebar-section-label">Navigation</span>
          <nav class="sidebar-menu" aria-label="Main">
            <button type="button" id="newTicketBtn" class="sidebar-menu-item" aria-label="Create Ticket" data-tooltip="Create Ticket"><span class="icon" id="icon-new-ticket"></span><span class="label">Create Ticket</span></button>
            <a href="#" class="sidebar-menu-item active" aria-current="page" data-tooltip="My Tickets"><span class="icon" id="icon-my-tickets"></span><span class="label">My Tickets</span></a>
            <a href="#" class="sidebar-menu-item" data-tooltip="All Tickets"><span class="icon" id="icon-all-tickets"></span><span class="label">All Tickets</span></a>
            <a href="#" class="sidebar-menu-item" data-tooltip="Starred"><span class="icon" id="icon-starred"></span><span class="label">Starred</span></a>
          </nav>
        </section>
        <div class="sidebar-divider" aria-hidden="true"></div>
        <section class="sidebar-section" aria-label="Utilities">
          <span class="sidebar-section-label">Utilities</span>
          <nav class="sidebar-menu" aria-label="Utilities">
            <a href="#" class="sidebar-menu-item" data-tooltip="Search"><span class="icon" id="icon-search"></span><span class="label">Search</span></a>
            <a href="#" class="sidebar-menu-item" data-tooltip="Reports"><span class="icon" id="icon-reports"></span><span class="label">Reports</span></a>
            <button type="button" class="sidebar-menu-item" id="notificationsBtn" aria-label="Notifications" data-tooltip="Notifications">
              <span class="icon" id="icon-notifications"></span>
              <span class="label">Notifications</span>
              <span class="notification-badge">0</span>
            </button>
            <button type="button" class="sidebar-menu-item" id="refreshBtn" aria-label="Refresh" data-tooltip="Refresh"><span class="icon" id="icon-refresh"></span><span class="label">Refresh</span></button>
            <button type="button" class="sidebar-menu-item" id="clearCacheBtn" aria-label="Clear Cache" title="Clear local cache to force refresh" data-tooltip="Clear Cache"><span class="icon" id="icon-clear-cache"></span><span class="label">Clear Cache</span></button>
          </nav>
        </section>
        <div class="sidebar-divider" aria-hidden="true"></div>
      </div>
    </aside>

    <!-- MAIN WRAPPER -->
    <div class="main-wrapper" role="main">

      <header class="header-enhanced" aria-label="Primary">
        <div class="header-left-section">
          <div class="header-brand">
            <span class="brand-icon">âš¡</span>
            <span class="brand-text">SpeedyFlow</span>
          </div>
          <div class="header-divider-vertical"></div>
          <h1 class="header-page-title">
            <span class="page-title-text">Tickets</span>
          </h1>
        </div>
        
        <div class="header-center-section">
          <nav aria-label="Breadcrumb" class="breadcrumb-enhanced">
            <span class="breadcrumb-item" id="deskBreadcrumb">Select Desk</span>
            <span class="breadcrumb-separator" aria-hidden="true">â€º</span>
            <span class="breadcrumb-item" id="queueBreadcrumb">Select Queue</span>
          </nav>
        </div>
        
        <div class="header-right-section">
          <div class="header-status-badge">
            <span class="status-indicator"></span>
            <span class="status-text" id="filterStatus">Ready</span>
          </div>
          <div class="header-divider-vertical"></div>
          <div class="header-account-actions">
            <button class="header-icon-btn" id="headerHelpBtn" title="Help Center" aria-label="Help Center">
              <span class="icon" id="icon-header-help"></span>
            </button>
            <button class="header-icon-btn" id="headerSettingsBtn" title="Settings" aria-label="Settings">
              <span class="icon" id="icon-header-settings"></span>
            </button>
            <button class="header-icon-btn" id="headerUserMenuBtn" title="Profile" aria-label="Profile">
              <span class="icon" id="icon-header-user"></span>
            </button>
          </div>
        </div>
      </header>

      <div class="filter-bar-enhanced" aria-label="Filters">
        <!-- Primary Filters -->
        <div class="filter-section filter-primary">
            <div class="filter-group">
              <label for="serviceDeskSelectFilter" class="filter-label">
                <span class="filter-icon" id="icon-filter-desk"></span>
                <span class="filter-text">Service Desk</span>
              </label>
              <div class="filter-input-wrapper">
                <select id="serviceDeskSelectFilter" class="filter-select">
                  <option value="">Select Desk...</option>
                </select>
                <span class="filter-dropdown-icon">â–¼</span>
              </div>
            </div>
            
            <div class="filter-group">
              <label for="queueSelectFilter" class="filter-label">
                <span class="filter-icon" id="icon-filter-queue"></span>
                <span class="filter-text">Queue</span>
              </label>
              <div class="filter-input-wrapper filter-with-action">
                <select id="queueSelectFilter" class="filter-select">
                  <option value="">Select Queue...</option>
                </select>
                <span class="filter-dropdown-icon">â–¼</span>
                <button id="saveFiltersBtn" class="filter-action-btn" title="Save current filters">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 3H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H7V5h8v4z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Divider -->
          <div class="filter-divider"></div>

          <!-- View Controls -->
          <div class="filter-section filter-controls">
            <div class="filter-group">
              <label class="filter-label">
                <span class="filter-icon" id="icon-filter-view"></span>
                <span class="filter-text">View Mode</span>
              </label>
              <div class="view-toggle-enhanced" role="tablist">
                <button class="view-btn active" data-view="kanban" aria-selected="true" role="tab">
                  <span class="view-icon" id="icon-view-board"></span>
                  <span class="view-text">Board</span>
                </button>
                <button class="view-btn" data-view="list" role="tab">
                  <span class="view-icon" id="icon-view-list"></span>
                  <span class="view-text">List</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Divider -->
          <div class="filter-divider"></div>

          <!-- Theme Controls -->
          <div class="filter-section filter-theme">
            <div class="filter-group">
              <label class="filter-label">
                <span class="filter-icon">âœ¨</span>
                <span class="filter-text">Customize</span>
              </label>
              <div class="theme-controls">
                <button id="bgSelectorHeaderBtn" class="theme-btn" title="Change background">
                  <span class="theme-btn-icon">ðŸŽ¨</span>
                  <span class="theme-btn-text">Background</span>
                </button>
                <button id="themeToggleBtn" class="theme-btn" title="Toggle theme">
                  <span class="theme-btn-icon">ðŸŽ­</span>
                  <span class="theme-btn-text">Theme</span>
                </button>
              </div>
            </div>
          </div>
        </div>

      <div class="board-wrapper" id="boardWrapper">
        <div id="kanbanView" class="kanban-board" aria-live="polite">
          <div class="placeholder-pro" id="kanbanPlaceholder">Loading tickets...</div>
        </div>
        <div id="listView" class="list-view" aria-live="polite">
          <div class="placeholder-pro" id="listPlaceholder">Loading tickets...</div>
        </div>
      </div>
    </div>
  </div>


      <!-- Flowing Content root: footer contains header and balanced view so
           the header is positioned relative to the footer (prevents it from
           appearing as a top-of-page banner). JS still may move or reuse
           nodes inside the footer at runtime. -->

      <div id="flowing-root" class="flowing-root" aria-hidden="false">
        <div id="flowingFooter" class="flowing-footer" aria-hidden="false">
          <div id="flowingHeader" class="flowing-header" role="footer" aria-hidden="false" style="display:flex;align-items:center;gap:12px;margin-right:8px;">
            <div style="display:flex;align-items:center;gap:8px;">
              <div class="flowing-brand" style="font-weight:600;">Flowing</div>
              <div id="flowingContextBadge" class="context-badge" aria-hidden="false"></div>
            </div>
            <div>
              <button id="flowingToggleBtn" class="flowing-toggle-btn" aria-label="Toggle Flowing" aria-expanded="false">â–¾</button>
            </div>
          </div>

          <div id="balancedView" class="flowing-view balanced-view" style="display:none;" aria-hidden="true">
            <div id="balancedContentContainer" class="balanced-content-container"></div>
          </div>
        </div>
      </div>

      <!-- Constants & Configuration (MUST load first) -->
  <script src="/static/js/constants/card-sizing.js"></script>
  <script src="/static/js/modules/sla-breach-risk.js?v={{ timestamp }}"></script>
  <script src="/static/js/sla-monitor.js?v={{ timestamp }}"></script>
  
  <!-- SVG Icons Module - Centralized icon library -->
  <!-- Load authoritative SVGIcons implementation early to avoid race conditions -->
  <script src="/static/js/utils/svg-icons.js?v={{ timestamp }}"></script>
  <!-- Bridge: will only inject if authoritative implementation is missing -->
  <script src="/static/js/svg-icons.js?v={{ timestamp }}"></script>
  
  <!-- Theme Manager - Centralized theme control -->
  <script src="/static/js/theme-manager.js?v={{ timestamp }}"></script>
  <script src="/static/js/sidebar-toggle.js?v={{ timestamp }}"></script>
  <script src="/static/js/sidebar-tooltip-manager.js?v={{ timestamp }}"></script>
  <script src="/static/js/modules/sidebar-actions.js?v={{ timestamp }}"></script>
  <script src="/static/js/header-menu-controller.js?v={{ timestamp }}"></script>
  <!-- Comments module must load before right-sidebar to provide comment utilities -->
  <!-- Notifications panel removed (disabled) -->
  
  <!-- ===== GLASSMORPHISM & TRANSPARENCY ===== -->
  <script src="/static/js/glassmorphism-opacity-controller.js?v={{ timestamp }}"></script>
  
  <!-- ===== BACKGROUND & AI EFFECTS ===== -->
  <script src="/static/js/background-manager.js?v={{ timestamp }}"></script>
  <script src="/static/js/background-selector-ui.js?v={{ timestamp }}"></script>
  <script src="/static/js/global-stubs.js?v={{ timestamp }}"></script>

  <!-- ===== UI ENHANCEMENTS ===== -->
  <script src="/static/js/app.js?v={{ timestamp }}"></script>
  <script src="/static/js/auto-severity-config.js?v={{ timestamp }}"></script>
  <script src="/static/js/filter-bar-manager.js?v={{ timestamp }}"></script>
  <script src="/static/js/loading-state-manager.js?v={{ timestamp }}"></script>
  <script src="/static/js/loading-dots.js?v={{ timestamp }}"></script>

  <!-- ===== AI & ML MODULES ===== -->
  <script src="/static/js/modules/ai-queue-analyzer.js?v={{ timestamp }}"></script>
  <script src="/static/js/modules/view-toggle-filters.js?v={{ timestamp }}"></script>
  <script src="/static/js/modules/sidebar-inline-editor.js?v={{ timestamp }}"></script>
  <!-- Previously disabled: ml-anomaly-dashboard.js (obsolete) - removed to avoid auto-opening modals -->

  <!-- ===== QUICK ACTIONS (Quick Triage & Smart Filters) ===== -->
  <script src="/static/js/quick-triage.js?v={{ timestamp }}"></script>
  <script src="/static/js/smart-filters.js?v={{ timestamp }}"></script>
  <script src="/static/js/smart-functions-modal.js?v={{ timestamp }}"></script>
  <script src="/static/js/smart-analytics.js?v={{ timestamp }}"></script>

    <!-- FLOWING MVP FOOTER -->
    <!-- Flowing Content (rendered dynamically by `flowing-mvp-footer.js`) -->
  <!-- Root container for Flowing MVP (required by flowing-mvp-footer.js) -->
    <!-- Flowing audio utilities removed (deprecated) -->

  <script type="module" data-flowing-footer src="/static/js/flowing-mvp-footer.js?v={{ timestamp }}"></script>
  <!-- Loader fallback: ensures footer script is loaded if original request failed -->
  <script src="/static/js/flowing-mvp-loader.js?v={{ timestamp }}"></script>


  <!-- User Setup Modal -->
  <script src="/static/js/user-setup-modal.js?v={{ timestamp }}"></script>

  <!-- (duplicate script block removed) -->

</body>
</html>
