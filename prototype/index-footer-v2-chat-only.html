<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowing MVP - Footer with Chat Only</title>
    <link rel="stylesheet" href="styles-footer-v2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1><i class="fas fa-rocket"></i> SPEEDYFLOW Flowing MVP</h1>
            <span class="badge badge-beta">AI Powered + Chat Only</span>
        </div>
        <div class="header-right">
            <div class="ml-status">
                <i class="fas fa-circle status-dot"></i>
                <span>ML Service: <strong id="mlServiceStatus">Connected</strong></span>
            </div>
        </div>
    </header>

    <!-- Main Content Area - Ticket Board -->
    <div class="main-content">
        <div class="ticket-board">
            <h2><i class="fas fa-columns"></i> Kanban Board</h2>
            <div class="board-columns">
                <div class="board-column">
                    <h3>Abierto</h3>
                    <div class="ticket-card" onclick="selectTicket('MSM-1234')">
                        <div class="ticket-key">MSM-1234</div>
                        <div class="ticket-summary">Error en API de autenticación</div>
                        <div class="ticket-meta">
                            <span class="priority high">Alta</span>
                            <span class="assignee">Carlos Q.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== FLOWING MVP FOOTER (Chat Only) ===== -->
    <div id="flowingFooter" class="flowing-footer collapsed">
        <!-- Toggle Button -->
        <button id="flowingToggleBtn" class="flowing-toggle-btn" title="Flowing MVP Assistant">
            <span class="flowing-icon flowing-sf-logo">SF</span>
            <div class="flowing-info">
                <span class="flowing-label">Flowing MVP</span>
                <span class="flowing-suggestion" id="flowingSuggestion">Click to chat...</span>
            </div>
            <span class="flowing-chevron"></span>
        </button>

        <!-- Flowing Content -->
        <div class="flowing-content">
            <div class="flowing-header">
                <div class="flowing-title">
                    <span class="flowing-avatar flowing-sf-logo">SF</span>
                    <div class="flowing-title-text">
                        <h3>Flowing MVP</h3>
                        <p class="flowing-subtitle">Your AI assistant for tickets, SLAs, and smart suggestions</p>
                    </div>
                </div>
                <button id="flowingCloseBtn" class="flowing-close-btn" title="Close"></button>
            </div>

            <!-- Messages Container -->
            <div id="flowingMessages" class="flowing-messages">
                <div class="flowing-message assistant">
                    <div class="message-avatar flowing-sf-logo">SF</div>
                    <div class="message-content">
                        <p> Hi! I'm Flowing MVP, your SpeedyFlow Ticket Solving Mate! I can help you with:</p>
                        <ul>
                            <li> Analyzing ticket priorities and patterns</li>
                            <li> Explaining SLA statuses and deadlines</li>
                            <li> Suggesting next actions for tickets</li>
                            <li> Providing insights on queue metrics</li>
                        </ul>
                        <p>Just ask me anything!</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="flowing-input-area">
                <div class="flowing-context-badge" id="flowingContextBadge">
                    <span class="context-icon"></span>
                    <span class="context-text">No context</span>
                </div>
                <div class="flowing-input-wrapper">
                    <input type="text" id="flowingInput" placeholder="Ask me anything about your tickets..." />
                    <button id="flowingSendBtn" class="flowing-send-btn" title="Send">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app-footer-v2.js"></script>
    <script src="ml_client.js"></script>
    <script>
    // Flowing MVP Chat Logic
    const flowingFooter = document.getElementById('flowingFooter');
    const flowingToggleBtn = document.getElementById('flowingToggleBtn');
    const flowingCloseBtn = document.getElementById('flowingCloseBtn');
    const flowingInput = document.getElementById('flowingInput');
    const flowingSendBtn = document.getElementById('flowingSendBtn');
    const flowingMessages = document.getElementById('flowingMessages');
    let selectedTicketKey = null;

    // Toggle footer
    flowingToggleBtn.addEventListener('click', () => {
        flowingFooter.classList.toggle('collapsed');
    });

    flowingCloseBtn.addEventListener('click', () => {
        flowingFooter.classList.add('collapsed');
    });

    // Send message
    flowingSendBtn.addEventListener('click', sendMessage);
    flowingInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
        const text = flowingInput.value.trim();
        if (!text) return;

        // Add user message
        addMessage(text, 'user');
        flowingInput.value = '';

        // Simulate AI response
        setTimeout(() => {
            const response = generateResponse(text);
            addMessage(response, 'assistant');
        }, 1000);
    }

    function addMessage(text, type) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `flowing-message ${type}`;
        
        if (type === 'assistant') {
            msgDiv.innerHTML = `
                <div class="message-avatar flowing-sf-logo">SF</div>
                <div class="message-content"><p>${text}</p></div>
            `;
        } else {
            msgDiv.innerHTML = `
                <div class="message-content"><p>${text}</p></div>
            `;
        }
        
        flowingMessages.appendChild(msgDiv);
        flowingMessages.scrollTop = flowingMessages.scrollHeight;
    }

    function generateResponse(text) {
        const lower = text.toLowerCase();
        if (lower.includes('sla') || lower.includes('deadline')) {
            return ' Based on your current SLA, ticket MSM-1234 has 2 hours remaining before breach. Priority: High.';
        } else if (lower.includes('priority') || lower.includes('critical')) {
            return ' You have 2 critical tickets in your queue that need immediate attention: MSM-1235 and MSM-1238.';
        } else if (lower.includes('suggest') || lower.includes('next')) {
            return ' I suggest focusing on MSM-1235 first - it\'s unassigned and critical. Would you like me to help you analyze it?';
        } else {
            return ' I can help you with ticket analysis, SLA monitoring, and priority suggestions. What would you like to know?';
        }
    }

    function selectTicket(key) {
        selectedTicketKey = key;
        const contextBadge = document.getElementById('flowingContextBadge');
        contextBadge.innerHTML = `<span class="context-icon"></span><span class="context-text">${key}</span>`;
        flowingSuggestion.textContent = `${key} selected - Ask me about it!`;
    }
    </script>
</body>
</html>
